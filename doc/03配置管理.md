# 配置管理

本地模式时：
>请求URL: http://dev-ip-addr:port:/api/config
>请求类型: POST
>HTTP头：token = , 使用登陆时返回的token
>请求消息体:JSON
>返回消息体:JSON, retcode = 0时正确， 非0时出错

1. 查询设备的配置项：
- 请求
```json
{
    "action": "list"
}
```

- 响应
```json
{
    "params": [
        {
            "key": "manufacturer",
            "modified": "2020-04-26 13:57:07",
            "options": 0,
            "value": "BaShi Technology Ltd. co,"
        },
        
        ...

        {
            "key": "device-id",
            "modified": "2020-04-26 13:57:07",
            "options": 0,
            "value": "KssDeLd5m6wYRiNXKFCHqe"
        }
    ],
    "retcode": 0
}
```
> options: 0表示只读， 1/2表示可配置

2. 获取设备的配置：
- 请求
```json
{
    "action": "get",
    "params": [
        "relay-mode",
        "therm-mode",
        "algm-threshold",
        "algm-version",
        "rs485-start-data",
        "rs485-close-data"
    ]
}
```
>params 数组内的数据项为请求的配置项，支持同时获取多个配置项

- 响应
```
{
    "params": [
        {
            "relay-mode": "1"
        },
        {
            "therm-mode": "0"
        },
        {
            "algm-threshold": "0.8"
        },
        {
            "algm-version": "3"
        },
        {
            "rs485-start-data": "open-door-rs485-data"
        },
        {
            "rs485-close-data": "close-door-rs485-data"
        }
    ],
    "retcode": 0
}
```

3. 配置设备
- 请求
```json
{
    "action": "set",
    "params": [
        {
            "relay-mode": "1"
        },
        {
            "therm-mode": "0"
        },
        {
            "algm-threshold": "0.8"
        }
    ]
}
```

- 响应
```json
{
    "params": [
        {
            "relay-mode": "1"
        },
        {
            "therm-mode": "0"
        },
        {
            "algm-threshold": "0.8"
        }
    ],
    "retcode": 0
}
```

4. 配置说明
以下为可配置数据
```json
{
    // 设备管理模式，目前支持cloud:智云，local：本地，mixed：同时支持二者
    {
        "key":"manager-mode",
         "value":"mixed",
         "options" : 1
    },

    // 智云服务器地址与端口号
    {
        "key":"cloud-server-address",
         "value":"127.0.0.1",
         "options" : 1
    },

    {
        "key":"cloud-server-port",
         "value":"8000",
         "options" : 1
    },

    // 智云平台断开后重连接时延，秒数
    {
        "key":"cloud-reconnect-duration" ,
         "value": "16",
         "options" : 1
    },

    // 智云平台心跳时延，秒数
    {
        "key":"hearbeat-duration" ,
         "value": "5",
         "options" : 1
    },

    // 本地服务端口号
    {
        "key":"local-server-port",
         "value":"8000",
         "options" : 1
    },

    // 本地服务模式，管理服务器地址/端口/访问路径，用于事件通知
    {
        "key":"manager-server-address",
         "value":"127.0.0.1",
         "options" : 1
    },

    {
        "key":"manager-server-port",
         "value":"3000",
         "options" : 1
    },

    {
        "key":"manager-server-path",
         "value":"report",
         "options" : 1
    },

    // 设备支持的最大用户数
    {
        "key":"user-max",
         "value": "1000",
         "options" : 2
    },

    // 设备支持的最大纪录数
    {
        "key":"user-logr-max",
         "value": "40000",
         "options" : 2
    },

    // 设备支持的最大访客数
    {
        "key":"visitor-max",
         "value": "100",
         "options" : 2
    },

    // 访客二维码UI显示时延
    {
        "key":"visitor-duration",
         "value": "16",
         "options" : 2
    },

    // 提示信息显示时延
    {
        "key":"tips-duration",
         "value": "2",
         "options" : 2
    },

    // 识别后显示时延
    {
        "key":"recognized-duration",
         "value": "2",
         "options" : 2
    },

    // 广告显示时延
    {
        "key":"advertising-duration",
         "value": "10",
         "options" : 2
    },

    // 开门时延
    {
        "key":"door-duration",
         "value": "3",
         "options" : 2
    },

    // 系统信息显示时延
    {
        "key":"info-duration",
         "value":"10",
         "options" : 2
    },

    // 人脸识别模式：0 不识别， 1 人脸识别， 2 口罩检测
    {
        "key":"face-mode",
         "value":"1",
         "options" : 2
    },

    // 是否支持访客
    {
        "key":"visitor-mode",
         "value":"1",
         "options" : 2
    },

    // 是否使用RS485端口，0不支持，1支持开门，2支持语音播放，3支持测温输入
    {
        "key":"rs485-mode",
         "value":"0",
         "options" : 2
    },

    // 是否支持语音播放
    {
        "key":"voice-mode",
         "value":"1",
         "options" : 2
    },

    // 是否支持继电器开门
    {
        "key":"relay-mode",
         "value":"1",
         "options" : 2
    },

    // 是否支持测温模块
    {
        "key":"therm-mode",
         "value":"0",
         "options" : 2
    },

    // 是否支持健康码
    {
        "key":"healthcode-mode",
         "value":"1",
         "options" : 2
    },

    // 测温模块修正值
    {
        "key":"therm-fix",
        "value":"0",
        "options":2
    },

    // 测温模块阈值
    {
        "key":"therm-threshold",
        "value":"36.5",
        "options":2
    },

    // 是否支持事件通知
    {
        "key":"event-mode",
         "value":"1",
         "options" : 1
    },

    // 识别算法比对阈值
    {
        "key":"algm-threshold",
         "value":"0.8",
         "options" : 2
    },

    // RS485动作发送数据，分为开、关两部分
    {
        "key":"rs485-start-data",
         "value":"open-door-rs485-data",
         "options" : 2
    },

    {
        "key":"rs485-close-data",
         "value":"close-door-rs485-data",
         "options" : 2
    }
}

```